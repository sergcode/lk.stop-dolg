<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="[[++modx_charset]]" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <!--     <meta name="robots" content="all"/>
    <meta name="robots" content="noindex, follow"/> -->
    <meta name="robots" content="noindex">
    <meta name="apple-mobile-web-app-capable" content="on">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="LK.Stop-dolg.ru">
    <meta name="application-name" content="LK.Stop-dolg.ru">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <title>[[*pagetitle]] | [[++site_name]]</title>
    <base href="[[!++site_url]]" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/apple-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/apple-icon-precomposed.png">
    <link rel="icon" type="image/png" sizes="36x36" href="/android-icon-36x36.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/android-icon-48x48.png">
    <link rel="icon" type="image/png" sizes="72x72" href="/android-icon-72x72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/android-icon-96x96.png">
    <link rel="icon" type="image/png" sizes="144x144" href="/android-icon-144x144.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/jquery-jgrowl/1.4.1/jquery.jgrowl.min.css" />
    <link rel="stylesheet" href="/assets/css/style.css?v=[[!date.version]]">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jgrowl/1.4.1/jquery.jgrowl.min.js"></script>
	<!-- html5.js for IE less than 9 -->
    <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- css3-mediaqueries.js for IE less than 9 -->
    <!--[if lt IE 9]>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->
</head>
<body>
    [[$disabled_JavaScript]]
    <main class="login" id="office-auth-form" role="main">
        <div class="login__content office-auth-login-wrapper">
            <a href="https://stop-dolg.ru/" title="Открыть в новой вкладке сайт компании &laquo;Стопдолг&raquo;" target="_blank">
                <div class="login__logo-wrapper">
                    <div class="login__logo animation-glare">
                         <svg width="125" height="95" viewBox="0 0 125 95" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M38.7261 51.8445H57.8648V0H24.5215C11.0646 0 0 10.7165 0 23.75V71.25C0 84.4284 11.0646 95 24.5215 95H57.7153V81.532H28.8577C23.4749 81.532 19.1388 77.3323 19.1388 72.1189V23.0259C19.1388 17.8125 23.4749 13.6128 28.8577 13.6128H40.3708C39.3242 16.7988 38.7261 20.2744 38.7261 23.8948V51.8445ZM86.4234 71.3948C86.4234 75.0152 85.8254 78.4909 84.7787 81.6768H96.2919C101.675 81.6768 106.011 77.4771 106.011 72.2637V23.0259C106.011 17.8125 101.675 13.6128 96.2919 13.6128L67.2847 13.468V0H100.478C114.085 0 125 10.7165 125 23.75V71.25C125 84.4284 113.935 95 100.478 95H67.2847V43.3003H86.4234V71.3948Z" fill="white"/>
                        </svg>
                    </div>
                    <img src="/assets/images/logo/logo-text-white.svg" alt="Стопдолг. Юридическая компания." class="login__logo-text">
                </div>
            </a>
            <h1 class="login__title">Вход</h1>
            
            <form action="" class="login__form" method="post" role="form">
                <fieldset>
                    <div class="login__input-container">
                        <input class="login__input" name="phone" data-inputmask="'mask': '+7 (999) 999-99-99'" type="text" autocomplete="on" required>
                        <label class="login__label">Введите Ваш телефон</label>
                    </div>
                    
                    
                    <div id="code-input" class="login__input-container" style='display:none'>
                        <input class="login__input" name="code" data-inputmask="'mask': '9999'" type="text" id="code" autocomplete="off">
                        <label class="login__label">Введите код из СМС</label>
                    </div>
                    <div id="send-retry" style="display:none" class="login__input-container">
                       
                    </div>
<!--                     <a class="login__link" href="/[[~15]]" role="link">Забыли пароль?</a>
 -->                    <input name="return" type="hidden" value=""/>
                    <button class="login__button animation-glare" type="submit" role="button">Войти</button>
                    <a class="login__link" href="/[[~271]]" role="link">Войти с помощью Email</a>
                    <a class="login__link" href="/[[~260]]" role="link">Регистрация</a>
                </fieldset>
            </form>
        </div>
    </main>
    <script src="/assets/js/jquery.inputmask/jquery.inputmask.min.js"></script>
    

    <script defer>
    
    
    var timerInterval = null
    
    function runTimer(timeMillis) {
        const endTime = new Date().getTime() + timeMillis;
        const setIntervalDelta = 970;
        $('#send-retry').html('Повторно отправить код можно через: <span id="timer">1:00</span>')
        let millis;
        let minutes;
        let seconds;
        let formattedString;
        if (timerInterval) {
            return
        }
        timerInterval = setInterval(() => {
            millis = endTime - (new Date().getTime());
            if (millis <= 0) {
                clearInterval(timerInterval);
                timerInterval = null;
                $('#send-retry').html('<button type="button" id="send-again" class="login__link">Выслать код повторно</button>')
                return;
            }
            seconds = Math.floor(millis / 1000) % 60;
            minutes = Math.floor(Math.floor((millis / 1000)) / 60);
            millis = millis % 1000;
    
            // minutes = Math.floor(millis / 60000);
            // seconds = ((millis % 60000) / 1000).toFixed(0);
            formattedString = minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
    
            if ($('#timer').text() !== formattedString) {
                $('#timer').text(formattedString);
            }
        }, setIntervalDelta);
    }
            
    
    
        $(document).ready(function(){
            
            $(document).on('click', '#send-again', function (e) {
                $('#code').val(null)
                $('#code').prop('required', false)
                $('.login__form').submit()
            })
        
            $("[data-inputmask]").inputmask();
            
            $('.login__form').submit(function(e){
                e.preventDefault();
                var fd = new FormData(this);
                fd.append('action', 'login');
              
                $.ajax({
                    type: "POST",
                    url: "/assets/ajax.php",
                    data: fd,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success: function(msg){
                        mass = JSON.parse(msg);
                        if (mass.status == 'error') {
                            $.jGrowl(mass.message);
                        } else if(mass.status == 'success'){
                            if(mass.redirect){
                               document.location.href = "[[~1]]";
                            }else{
                                $.jGrowl(mass.message);
                                $("#code-input").slideDown();
                                $("#send-retry").slideDown();
                                $("#code").prop("required",true);
                                
                                runTimer(60500);

                            }
                        } 
                    }
                });            
                
            });
            
        });
    </script>
    [[$yandex_metrika]]
</body>
</html>
