"use strict";window.addEventListener("DOMContentLoaded",()=>{const t=window.matchMedia("(max-width: 440.98px)");let e=[],a=[],s=[],l=[],o=[],n=1;const i=document.createElement("div");function c(t){const e=document.createElement("div");e.classList.add("form-modal__sending"),e.innerHTML='\n      <article role="article">\n        <figure>\n          <div class="preloader__row">\n            <div class="preloader__item"></div>\n            <div class="preloader__item"></div>\n          </div>\n          <figcaption class="form-modal__sending_status">Сообщение отправляется, <br>подождите!</figcaption>\n        </figure>\n      </article>\n    ',t.parentElement.append(e)}function r(t){const e=document.createElement("button");e.classList.add("attach__delete-files","hide"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.innerHTML='\n\t\t\t<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M5.1875 6.1875C5.33668 6.1875 5.47976 6.24676 5.58525 6.35225C5.69074 6.45774 5.75 6.60082 5.75 6.75V13.5C5.75 13.6492 5.69074 13.7923 5.58525 13.8977C5.47976 14.0032 5.33668 14.0625 5.1875 14.0625C5.03832 14.0625 4.89524 14.0032 4.78975 13.8977C4.68426 13.7923 4.625 13.6492 4.625 13.5V6.75C4.625 6.60082 4.68426 6.45774 4.78975 6.35225C4.89524 6.24676 5.03832 6.1875 5.1875 6.1875V6.1875ZM8 6.1875C8.14918 6.1875 8.29226 6.24676 8.39775 6.35225C8.50324 6.45774 8.5625 6.60082 8.5625 6.75V13.5C8.5625 13.6492 8.50324 13.7923 8.39775 13.8977C8.29226 14.0032 8.14918 14.0625 8 14.0625C7.85082 14.0625 7.70774 14.0032 7.60225 13.8977C7.49676 13.7923 7.4375 13.6492 7.4375 13.5V6.75C7.4375 6.60082 7.49676 6.45774 7.60225 6.35225C7.70774 6.24676 7.85082 6.1875 8 6.1875V6.1875ZM11.375 6.75C11.375 6.60082 11.3157 6.45774 11.2102 6.35225C11.1048 6.24676 10.9617 6.1875 10.8125 6.1875C10.6633 6.1875 10.5202 6.24676 10.4148 6.35225C10.3093 6.45774 10.25 6.60082 10.25 6.75V13.5C10.25 13.6492 10.3093 13.7923 10.4148 13.8977C10.5202 14.0032 10.6633 14.0625 10.8125 14.0625C10.9617 14.0625 11.1048 14.0032 11.2102 13.8977C11.3157 13.7923 11.375 13.6492 11.375 13.5V6.75Z" fill="black"/>\n\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M15.3125 3.375C15.3125 3.67337 15.194 3.95952 14.983 4.1705C14.772 4.38147 14.4859 4.5 14.1875 4.5H13.625V14.625C13.625 15.2217 13.3879 15.794 12.966 16.216C12.544 16.6379 11.9717 16.875 11.375 16.875H4.625C4.02826 16.875 3.45597 16.6379 3.03401 16.216C2.61205 15.794 2.375 15.2217 2.375 14.625V4.5H1.8125C1.51413 4.5 1.22798 4.38147 1.017 4.1705C0.806026 3.95952 0.6875 3.67337 0.6875 3.375V2.25C0.6875 1.95163 0.806026 1.66548 1.017 1.4545C1.22798 1.24353 1.51413 1.125 1.8125 1.125H5.75C5.75 0.826631 5.86853 0.540483 6.07951 0.329505C6.29048 0.118526 6.57663 0 6.875 0L9.125 0C9.42337 0 9.70952 0.118526 9.92049 0.329505C10.1315 0.540483 10.25 0.826631 10.25 1.125H14.1875C14.4859 1.125 14.772 1.24353 14.983 1.4545C15.194 1.66548 15.3125 1.95163 15.3125 2.25V3.375ZM3.63275 4.5L3.5 4.56638V14.625C3.5 14.9234 3.61853 15.2095 3.82951 15.4205C4.04048 15.6315 4.32663 15.75 4.625 15.75H11.375C11.6734 15.75 11.9595 15.6315 12.1705 15.4205C12.3815 15.2095 12.5 14.9234 12.5 14.625V4.56638L12.3672 4.5H3.63275ZM1.8125 3.375V2.25H14.1875V3.375H1.8125Z" fill="black"/>\n\t\t\t</svg>\n\t\t\t\n\t\t\tУдалить все\n\t\t',t.prepend(e)}i.classList.add("toggle-modal-bg","toggle-modal-bg__warning"),document.body.append(i),function(){const t=document.createElement("div");t.classList.add("toggle-modal","toggle-modal__warning"),t.setAttribute("role","dialog"),t.innerHTML='\n\t\t\t<div class="toggle-modal__box toggle-modal__box_p-none">\n\t\t\t\t<div class="toggle-modal__body toggle-modal__body_pt-sm-50">\n\t\t\t\t\t<p class="modal__text modal__text_uppercase">Замена или пропуск файлов</p>\n\t\t\t\t\t<p class="modal__text modal__text_bold" data-number-file></p>\n\t\t\t\t\t<p class="modal__text" data-file-name></p>\n\t\t\t\t\t<p class="modal__text modal__text_middle modal__text_light modal__text_grey" data-warning-subtitle></p>\n\t\t\t\t\t<div class="modal__buttons modal__buttons_d-flex">\n\t\t\t\t\t\t<button class="button button--green" data-action="replaceFile" title="Замена" role="button"></button>\n\t\t\t\t\t\t<button class="button button--green" data-action="skipFile" title="Пропуск" role="button"></button>\n\t\t\t\t\t\t<button class="button button--green" data-action="requestForEachFile" role="button"></button>\n\t\t\t\t\t\t<button class="button button--green" data-action="cancel" role="button"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button class="toggle-modal__close toggle-modal__close_sm-green" data-action="warningClose" title="Закрыть" role="button"></button>\n\t\t\t',document.body.append(t)}(),function(){const t=document.createElement("div");t.classList.add("toggle-modal","toggle-modal__small","toggle-modal__file-updated"),t.setAttribute("role","dialog"),t.innerHTML='\n\t\t\t<div class="toggle-modal__box toggle-modal__box_p-none">\n        <div class="toggle-modal__body toggle-modal__body_white toggle-modal__body_pt-sm-50">\n            <article role="article">\n                <figure>\n                    <div class="toggle-modal__file-updated_wrapper">\n\t\t\t\t\t\t\t\t\t\t  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t\t\t\t\t\t\t\t\t\t\t\t viewBox="0 0 98.5 98.5" enable-background="new 0 0 98.5 98.5" xml:space="preserve">\n\t\t\t\t\t\t\t\t\t\t\t  <path class="checkmark" fill="none" stroke-width="8" stroke-miterlimit="10" d="M81.7,17.8C73.5,9.3,62,4,49.2,4\n\t\t\t\t\t\t\t\t\t\t\t\tC24.3,4,4,24.3,4,49.2s20.3,45.2,45.2,45.2s45.2-20.3,45.2-45.2c0-8.6-2.4-16.6-6.5-23.4l0,0L45.6,68.2L24.7,47.3"/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</div>\n                    <figcaption class="toggle-modal__text toggle-modal__title">\n                        Файлы обновлены\n                    </figcaption>\n                </figure>\n            </article>\n        </div>\n    \t</div>\n\t\t',document.body.append(t)}();const d=document.querySelector(".js-overlay-modal"),m=document.querySelector(".toggle-modal-bg__warning"),u=document.querySelectorAll("form"),_=document.querySelector(".toggle-modal__warning"),g=_.querySelectorAll("button"),h="attach__wrapper-created-files_scroll",f=document.querySelector(".toggle-modal__file-updated");let p=document.querySelector("p[data-number-file]"),v=document.querySelector("p[data-file-name]"),L=document.querySelector("p[data-warning-subtitle]"),b=document.querySelector(".toggle-modal__unsuccessfully");for(let l of u){const o=l.closest(".toggle-modal");if(l.classList.contains("ajax-save")){const n=l.querySelectorAll(".js-modal-close"),i=l.querySelector('input[name="rating"]'),d=l.querySelector("select"),u=l.querySelector("textarea"),h=l.querySelector(".form-modal__tooltip"),f=l.querySelector(".form-modal__tooltip span"),p=l.querySelector(".attach__wrapper-created-files"),L=l.querySelectorAll('input[type="file"]');S(d,l),L.forEach((l,o)=>{r(l.closest(".attach__search_wrapper-created-files").querySelector(".attach__container-created-files"));const n=document.querySelectorAll(".attach__delete-files")[o];l.addEventListener("change",function(l){l.preventDefault();const o=this,n=o.files,i=o.closest(".form-modal__row"),c=(o.closest(".toggle-modal"),o.closest(".attach__search_wrapper-created-files")),r=c.querySelector(".attach__delete-files"),d=c.querySelector(".attach__wrapper-created-files");a.length=0;for(let t of n)if(a.length){if(a.some(({name:e})=>e===t.name))continue;a.push(t)}else a.push(t);for(let t of a)e.some(({name:e})=>e===t.name)&&s.push(t);for(let t of a){if(e.some(({name:e})=>e===t.name)){m.classList.add("active"),_.classList.add("active"),o.value="",s.length>1?H(`В прикрепленных файлах есть файлы (${s.length}) с такими же именами`,"Заменить файлы","Пропустить файлы",!1,!0):(v.textContent=`${t.name}`,H("В прикрепленных файлах есть файл с таким же именем","Заменить файл","Пропустить файл",!0,!0));break}e.push(t),M(i,t,d,!1),o.value=""}e.length>1&&!r.classList.contains("show")&&r.classList.add("show"),t.matches&&r.classList.contains("show")&&r.classList.remove("show"),g.forEach(t=>t.onclick=(t=>{F(t,i,d)}))}),n.addEventListener("click",function(t){t.preventDefault(),A(p,l),I(this.closest(".toggle-modal"))})}),u&&(l.addEventListener("submit",function(t){t.preventDefault();const a=this,s=new FormData(a),r=a.querySelector('input[type="file"]');let m=t.target.querySelector(".js-open-modal-success-unsuccess").getAttribute("data-modal"),_=document.querySelector('.toggle-modal__successfully[data-modal="'+m+'"]');if(b.setAttribute("data-modal",`${m}`),d&&("Не выбрана"===d.value||"Не выбран"===d.value))return a.querySelector(".jq-selectbox__select").classList.add("invalid-input-select-textarea"),!1;if(e.length)for(let t of e)s.append("files[]",t),console.log(s);if(u.value.length>=5)return $.ajax({type:"POST",url:"/assets/ajax.php",data:s,contentType:!1,cache:!1,processData:!1,beforeSend:()=>{c(l)},success:t=>{"error"===JSON.parse(t).result?(console.log(t),x(o,b),y(n,"",""),C(b,"",""),w(b,"","")):(console.log(t),x(o,_),A(p,r),y(n,"",""),C(_,"",""),w(_,"",""),setTimeout(()=>{u.classList.remove("valid"),u.value="",f.innerText="0",i&&(i.checked=!1),a.reset()},1e3),k(d,a))},complete:()=>{E(l)},error:t=>{console.log(t),x(o,b),y(n,"",""),C(b,"",""),w(b,"","")}}),!1;f.innerText=u.value.length,h.classList.add("active"),u.classList.add("invalid-input-select-textarea")}),u.addEventListener("focus",function(){this.classList.add("valid")}),u.addEventListener("blur",function(){this.value||this.classList.remove("valid")}),u.addEventListener("input",function(){f.innerText=this.value.length,u.value.length>=5&&h.classList.contains("active")&&u.classList.contains("invalid-input-select-textarea")&&(h.classList.remove("active"),u.classList.remove("invalid-input-select-textarea"))})),y(n,u,h),C(o,u,h),w(o,u,h)}}function x(t,e){t.classList.add("remove"),setTimeout(()=>{t.classList.remove("active"),t.classList.remove("remove"),e.classList.add("active")},300)}function y(t,e,a){t.forEach(t=>{t.addEventListener("click",function(){const t=this.closest(".toggle-modal"),s=t.querySelector(".toggle-modal__box");t.classList.contains("active")&&t.getAttribute("style")&&t.removeAttribute("style"),t.classList.contains("active")&&(t.classList.add("remove"),d.classList.add("remove"),t.classList.contains("toggle-modal__animation-hide")&&t.classList.remove("toggle-modal__animation-hide"),t.classList.contains("toggle-modal__scroll")&&(t.classList.remove("toggle-modal__scroll"),s.removeAttribute("style")),q(t,a,e))})})}function C(t,e,a){d.addEventListener("click",s=>{s.preventDefault(),t.classList.contains("active")&&(t.classList.add("remove"),d.classList.add("remove"),t.classList.contains("toggle-modal__animation-hide")&&t.classList.remove("toggle-modal__animation-hide"),t.classList.contains("toggle-modal__scroll")&&t.classList.remove("toggle-modal__scroll"),q(t,a,e))})}function w(t,e,a){document.body.addEventListener("keyup",s=>{"Escape"===s.key&&t.classList.contains("active")&&(t.classList.add("remove"),d.classList.add("remove"),t.classList.contains("toggle-modal__animation-hide")&&t.classList.remove("toggle-modal__animation-hide"),t.classList.contains("toggle-modal__scroll")&&t.classList.remove("toggle-modal__scroll"),q(t,e,a))})}function q(t,e,a){setTimeout(()=>{t.classList.remove("active"),t.classList.remove("remove"),d.classList.remove("active"),d.classList.remove("remove"),a&&(e.classList.remove("active"),a.classList.remove("invalid-input-select-textarea"))},300)}function E(t){t.parentElement.querySelector(".form-modal__sending").remove()}function S(t,e){t&&(t.onchange=function(){const t=e.querySelector(".jq-selectbox__select");"Не выбрана"===this.value&&"Не выбран"===this.value||!t.classList.contains("invalid-input-select-textarea")||t.classList.remove("invalid-input-select-textarea")})}function k(t,e){if(t){const a=e.querySelector(".jq-selectbox"),s=a.querySelector(".jq-selectbox__select");a.classList.contains("changed")&&(a.classList.remove("changed"),s.querySelector(".jq-selectbox__select-text").innerText=t.querySelector("option[selected]").value,a.querySelectorAll(".jq-selectbox__dropdown ul li").forEach((t,e)=>{t.removeAttribute("class"),0===e&&t.classList.add("selected","sel")}))}}function A(t,a){if(a&&t&&t.childElementCount>0){const s=a.closest(".attach__search_wrapper-created-files").querySelector(".attach__delete-files");for(a.value="",e.length=0;t.firstChild;)t.removeChild(t.firstChild);s&&s.classList.contains("show")&&s.classList.remove("show")}}function F(t,i,c){t.preventDefault();const r=t.target.closest(".toggle-modal__warning");if(a.length)for(let d of a){const m=d.name,u=e.some(({name:t})=>t===m),_=e.some(({name:t})=>t!==m);if(t.target.matches('[data-action="requestForEachFile"]')&&(r.classList.add("requestForEachFile"),H("В прикрепленных файлах есть файл с таким же именем","Заменить файл","Пропустить файл",!0,!1)),r.classList.contains("requestForEachFile")){let d=v.textContent;if(u&&!d&&(p.textContent=`${n} / ${s.length}`,v.textContent=`${m}`),t.target.matches('[data-action="replaceFile"]')){if(e.some(({name:t})=>t===d)&&e[e.findIndex(t=>t.name===d)]&&(l.push(e[e.findIndex(t=>t.name===d)]),e.splice(e.findIndex(t=>t.name===d),1)),u&&e[e.findIndex(t=>t.name===m)])return p.textContent=`${Math.ceil(n+1)} / ${s.length}`,D(e[e.findIndex(t=>t.name===m)].name),n++;if(_&&n===s.length){if(Array.prototype.push.apply(e,a),c&&c.childElementCount>0)for(;c.firstChild;)c.removeChild(c.firstChild);e.forEach(t=>{M(i,t,c,!0)}),a.length=0,n=1}a.length||T(r)}if(t.target.matches('[data-action="skipFile"]')){if(a.some(({name:t})=>t===d)&&a[a.findIndex(t=>t.name===d)]&&(o.push(a[a.findIndex(t=>t.name===d)]),a.splice(a.findIndex(t=>t.name===d),1)),u&&a[a.findIndex(t=>t.name===e[e.findIndex(t=>t.name===m)].name)])return p.textContent=`${Math.floor(n+1)} / ${s.length}`,D(m),n++;_&&n===s.length&&(Array.prototype.push.apply(e,a),a.forEach(t=>{M(i,t,c,!1)}),a.length=0,n=1),a.length||T(r)}}else{if(t.target.matches('[data-action="replaceFile"]')&&(u&&e.splice(e.findIndex(t=>t.name===m),1),_)){if(e.push(d),c&&c.childElementCount>0)for(;c.firstChild;)c.removeChild(c.firstChild);e.forEach(t=>{M(i,t,c,!0)}),T(r)}if(t.target.matches('[data-action="skipFile"]')){if(u&&a.length>1){T(r);continue}if(_&&a.length>1&&(e.push(d),M(i,d,c,!1),T(r)),u&&1===a.length){T(r);continue}}}t.target.matches('[data-action="cancel"]')&&(r.classList.remove("requestForEachFile"),p.textContent="",v.textContent="",n=1,H(`В прикрепленных файлах есть файлы (${s.length}) с такими же именами`,"Заменить файлы","Пропустить файлы",!1,!0),l.length>0&&Array.prototype.push.apply(e,l),o.length>0&&Array.prototype.push.apply(a,o),[l,o].forEach(t=>t.length=0))}else T(r);t.target.matches('[data-action="warningClose"]')&&T(r)}function T(t){var e;p.textContent&&v.textContent&&(p.textContent="",v.textContent=""),t.classList.contains("requestForEachFile")&&t.classList.remove("requestForEachFile"),n=1,(e=t).classList.add("remove"),m.classList.add("remove"),setTimeout(()=>{e.classList.remove("active"),e.classList.remove("remove"),m.classList.remove("active"),m.classList.remove("remove"),[s,l,o].forEach(t=>{t.length>0&&(t.length=0)})},300)}function H(t,e,a,s,l){g.forEach(o=>{switch(L.textContent=`${t}`,o.getAttribute("data-action")){case"replaceFile":o.innerHTML=`\n\t\t\t\t\t\t<img src="/assets/images/icons/replace-file.svg" alt="Заменить файлы">\n\t\t\t\t\t\t${e}\n\t\t\t\t\t `;break;case"skipFile":o.innerHTML=`\n\t\t\t\t\t\t<img src="/assets/images/icons/skip.svg" alt="Пропустить файлы">\n\t\t\t\t\t\t${a}\n\t\t\t\t\t`;break;case"requestForEachFile":o.innerHTML='\n\t\t\t\t\t\t<img src="/assets/images/icons/file-check.svg" alt="Запрашивать для каждого файла">\n\t\t\t\t\t\tЗапрашивать для каждого файла\n\t\t\t\t\t',o.hidden=s;break;case"cancel":o.innerHTML='\n\t\t\t\t\t\t<img src="/assets/images/icons/file-uncheck.svg" alt="Отменить запрос">\n\t\t\t\t\t\tОтменить запрос\n\t\t\t\t\t',o.hidden=l}})}function M(t,a,l,o){t&&(!function(t,e,a){const l=t.name,o=l.beforeLastIndex("."),n=l.split(".").pop();e.append(function(t,e,a){const s=document.createElement("div");return s.classList.add("attach__file","attach__item--attached"),s.innerHTML=`\t\n\t\t\t<div class="attach__file_wrapper ${a}">\n\t\t\t\t<p>${e}</p>\n\t\t\t\t<div class="attach__name">${t}</div>\n\t\t\t</div>\n\t\t  <button class="attach__delete" title="Удалить файл" role="button"></button>\n\t\t`,s}(o,n,function(t){let e;switch(t){case"jpg":case"jpeg":case"png":case"tif":case"bmp":case"gif":e="attach__file_wrapper__purple";break;case"pdf":e="attach__file_wrapper__red";break;case"doc":case"docx":case"odt":case"txt":e="attach__file_wrapper__dark-blue";break;case"xls":case"xlsx":e="attach__file_wrapper__green";break;case"ppt":case"pptx":e="attach__file_wrapper__orange";break;case"rar":case"zip":case"7z":case"tar":case"arj":case"jar":e="attach__file_wrapper__gold";break;default:e="attach__file_wrapper__neutral"}return e}(n))),a&&function(t,e){e.querySelectorAll(".attach__file").forEach(t=>{const e=t.querySelector(".attach__name"),a=e.textContent+"."+e.previousElementSibling.textContent;s.some(({name:t})=>t===a)&&(f.classList.add("active"),setTimeout(()=>{f.classList.add("remove"),setTimeout(()=>{f.classList.remove("active"),f.classList.remove("remove"),e.classList.add("attach__file_new-file")},300)},1800)),setTimeout(()=>e.classList.remove("attach__file_new-file"),4e3)})}(0,e)}(a,l,o),function(t){const a=t.querySelectorAll(".attach__delete");for(let[s,l]of a.entries())l.onclick=function(a){a.preventDefault();const l=this.closest(".toggle-modal"),o=this.closest(".attach__file"),n=t.previousElementSibling;o.remove(),delete e[s],j(t),1===t.childElementCount&&n.classList.contains("show")&&n.classList.remove("show"),t.childElementCount<=0&&(e.length=0,I(l))}}(l),j(l))}function j(e){t.matches&&(e.childElementCount>2?e.classList.add(h):e.classList.remove(h))}function V(t){u.forEach(a=>{const s=a.closest(".toggle-modal");if(s&&s.classList.contains("active")&&a.classList.contains("ajax-save")){const l=s.querySelector(".toggle-modal__box"),o=a.querySelector(".attach__wrapper-created-files"),n=a.querySelector(".attach__delete-files");if(t.matches)o.childElementCount>2&&!o.classList.contains(h)&&o.classList.add(h),n.classList.remove("show"),s.classList.add("toggle-modal__animation-hide"),s.classList.remove("toggle-modal__scroll"),l.removeAttribute("style");else{const t=window.innerHeight;o.classList.contains(h)&&o.classList.remove(h),e.length>1&&n.classList.add("show"),s.classList.remove("toggle-modal__animation-hide"),s.classList.add("toggle-modal__scroll"),l.style.maxHeight=`${t}px`}}})}function I(t,e){const a=window.innerHeight,s=t.querySelector(".toggle-modal__box");e.matches&&s.scrollHeight<a?(t.classList.add("toggle-modal__animation-hide"),t.classList.remove("toggle-modal__scroll"),s.removeAttribute("style"),setTimeout(()=>t.classList.remove("toggle-modal__animation-hide"),1e3)):(t.classList.add("toggle-modal__scroll"),s.style.maxHeight=`${a}px`)}function D(t){v.classList.add("hide"),setTimeout(()=>{v.textContent=`${t}`,v.classList.remove("hide")},300)}document.body.addEventListener("click",t=>{t.target.matches('[class="toggle-modal__close js-modal-close"]')&&(t.preventDefault(),console.log(e))}),String.prototype.beforeLastIndex=function(t){return this.substr(0,this.lastIndexOf(t))||this+""},m.addEventListener("click",t=>{t.preventDefault(),T(_)}),V(t),t.addEventListener("change",V)});