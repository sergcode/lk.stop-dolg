"use strict";function nameFilesAttach(){String.prototype.beforeLastIndex=function(t){return this.substr(0,this.lastIndexOf(t))||this+""}}nameFilesAttach(),window.addEventListener("DOMContentLoaded",()=>{const t=window.matchMedia("(max-width: 440.98px)");function e(t){let e;switch(t){case"jpg":case"jpeg":case"png":case"tif":case"bmp":e="attach__file_wrapper__purple";break;case"pdf":e="attach__file_wrapper__red";break;case"doc":case"docx":case"odt":case"txt":e="attach__file_wrapper__dark-blue";break;case"xls":case"xlsx":e="attach__file_wrapper__green";break;case"ppt":case"pptx":e="attach__file_wrapper__orange";break;case"rar":case"zip":case"7z":case"tar":case"arj":case"jar":e="attach__file_wrapper__gold";break;default:e="attach__file_wrapper__neutral"}return e}function a(t,e,a){const c=document.createElement("div");return c.classList.add("attach__file","attach__item--attached"),c.innerHTML=`\t\n\t\t\t<div class="attach__file_wrapper ${a}">\n\t\t\t\t<p>${e}</p>\n\t\t\t\t<div class="attach__name">${t}</div>\n\t\t\t</div>\n\t\t  <button class="attach__delete" title="Удалить файл" role="button"></button>\n\t\t`,c}const c=t=>{t.sort()};let r=[];function s(t,s){for(let n=0;n<t[0].files.length;n++){let i=t[0].files[n].name,_=i.beforeLastIndex("."),o=i.split(".").pop();r.push(i),c(r),s.append(a(_,o,e(o)))}}function n(t,e,a){e.css("max-height",a.outerHeight()),t.css("max-height",t.outerHeight()+e.outerHeight())}function i(t){const e=$(".toggle-modal .attach__wrapper-created-files");t.matches?function(t){const e="attach__wrapper-created-files_scroll";t.children().length>3?t.addClass(e):t.removeClass(e)}(e):e.removeClass("attach__wrapper-created-files_scroll")}function _(e,a,c){$.each($(".attach__wrapper-created-files"),(s,_)=>{const o=$(_).find(".attach__delete");$.each(o,(a,c)=>{$(c).on("click",function(c){c.preventDefault();const s=$(this).closest(".attach__file"),n=s.closest(".task__accordion_item--buttons");s.remove(),r.splice(a,1),$(_).children().length<=0&&(r=[],e&&n.find('[name="taskAccordionAttach"]').attr("disabled","disabled")),i(t),t.addEventListener("change",i)})}),e&&a.outerHeight()>c.outerHeight()&&n(e,a,c)})}!function(e){e.each(e(".attach__input"),(a,c)=>{e(c).change(function(a){a.preventDefault();const c=e(this),r=c.closest(".task__accordion_item--more-info"),o=r.closest(".task__accordion_wrapper"),l=r.find(".task__accordion_item--more-wrapper"),d=l.find(".attach__wrapper-created-files"),p=c.closest(".form-modal__row"),h=p.find(".attach__wrapper-created-files");r&&(s(c,d),_(o,r,l),n(o,r,l),d.children().length>0&&l.find('[name="taskAccordionAttach"]').removeAttr("disabled")),p&&(s(c,h),_(),i(t),t.addEventListener("change",i))})})}(jQuery)});