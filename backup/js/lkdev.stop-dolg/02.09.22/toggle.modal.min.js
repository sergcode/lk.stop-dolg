"use strict";window.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("div");e.classList.add("toggle-modal-bg","js-overlay-modal"),document.body.append(e);const t=document.querySelectorAll(".js-open-modal"),s=document.querySelector(".js-overlay-modal"),a=document.querySelectorAll(".js-modal-close"),l=document.querySelector("button.tab__button[data-modal]"),c=document.querySelector('input[name="rating"]'),o=document.querySelectorAll(".toggle-modal");let i;function n(e,t){e.classList.add("remove"),setTimeout(()=>{e.classList.remove("active"),e.classList.remove("remove"),t.classList.add("active")},300)}function r(e,t,a){e.forEach(e=>{e.addEventListener("click",function(){const e=this.closest(".toggle-modal");e.classList.contains("active")&&(e.classList.add("remove"),s.classList.add("remove"),v(e,a,t))})})}function d(e,t,a){s.addEventListener("click",()=>{e.classList.contains("active")&&(e.classList.add("remove"),s.classList.add("remove"),v(e,a,t))})}function u(e,t,a){document.body.addEventListener("keyup",l=>{"Escape"===l.key&&e.classList.contains("active")&&(e.classList.add("remove"),s.classList.add("remove"),v(e,t,a))})}function v(e,t,a){setTimeout(()=>{e.classList.remove("active"),e.classList.remove("remove"),s.classList.remove("active"),s.classList.remove("remove"),L(),a&&(t.classList.remove("active"),a.classList.remove("invalid-input-select-textarea"))},300)}function m(e,t){if(e&&e.childElementCount>0)for(t.value="",i=[];e.firstChild;)e.removeChild(e.firstChild)}function L(){l&&(l.onclick=(()=>{l.classList.add("active")}),l.classList.remove("active"))}i=[],o.forEach(e=>{const t=e.querySelector(".ajax-save");if(t){const s=t.querySelector("select"),l=t.querySelector("textarea"),o=t.querySelector(".form-modal__tooltip"),v=t.querySelector(".form-modal__tooltip span"),L=t.querySelector(".attach__wrapper-created-files");!function(e,t){e&&(e.onchange=function(){const e=t.querySelector(".jq-selectbox__select");"Не выбрана"===this.value&&"Не выбран"===this.value||!e.classList.contains("invalid-input-select-textarea")||e.classList.remove("invalid-input-select-textarea")})}(s,t),l&&(t.addEventListener("submit",function(f){f.preventDefault();const p=t.querySelector(".jq-selectbox"),g=p.querySelector(".jq-selectbox__select"),y=this,_=new FormData(y),h=y.querySelector('input[type="file"]');let q=f.target.querySelector(".js-open-modal-success-unsuccess").getAttribute("data-modal"),S=document.querySelector('.toggle-modal__successfully[data-modal="'+q+'"]'),x=document.querySelector(".toggle-modal__unsuccessfully");if(x.setAttribute("data-modal",`${q}`),s&&("Не выбрана"===s.value||"Не выбран"===s.value))return g.classList.add("invalid-input-select-textarea"),!1;if(h){const e=h.files;for(let t=0;t<e.length;t++)i.push(e.item(t))}if(l.value.length>=5)return $.ajax({type:"POST",url:"/assets/ajax.php",data:_,contentType:!1,cache:!1,processData:!1,beforeSend:()=>{!function(e){const t=document.createElement("div");t.classList.add("form-modal__sending"),t.innerHTML='\n      <article role="article">\n        <figure>\n          <div class="preloader__row">\n            <div class="preloader__item"></div>\n            <div class="preloader__item"></div>\n          </div>\n          <figcaption class="form-modal__sending_status">Сообщение отправляется, <br>подождите!</figcaption>\n        </figure>\n      </article>\n    ',e.parentElement.append(t)}(y)},success:o=>{"error"===JSON.parse(o).result?(console.log(o),n(e,x),m(L,h),r(a,"",""),d(x,"",""),u(x,"","")):(console.log(o),n(e,S),m(L,h),r(a,"",""),d(S,"",""),u(S,"",""),setTimeout(()=>{l.classList.remove("valid"),l.value="",v.innerText="0",c.checked=!1,t.reset()},1e3),function(e,t,s){e&&t.classList.contains("changed")&&(t.classList.remove("changed"),s.querySelector(".jq-selectbox__select-text").innerText=e.querySelector("option[selected]").value,t.querySelectorAll(".jq-selectbox__dropdown ul li").forEach((e,t)=>{e.removeAttribute("class"),0===t&&e.classList.add("selected","sel")}))}(s,p,g))},complete:()=>{!function(e){e.parentElement.querySelector(".form-modal__sending").remove()}(y)},error:t=>{console.log(t),n(e,x),m(L,h),r(a,"",""),d(x,"",""),u(x,"","")}}),!1;v.innerText=l.value.length,o.classList.add("active"),l.classList.add("invalid-input-select-textarea")}),l.addEventListener("focus",function(){this.classList.add("valid")}),l.addEventListener("blur",function(){this.value||this.classList.remove("valid")}),l.addEventListener("input",function(){v.innerText=this.value.length,l.value.length>=5&&o.classList.contains("active")&&l.classList.contains("invalid-input-select-textarea")&&(o.classList.remove("active"),l.classList.remove("invalid-input-select-textarea"))})),r(a,l,o),d(e,l,o),u(e,l,o)}r(a,"",""),d(e,"",""),u(e,"","")}),L(),t.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-modal");document.querySelector('.toggle-modal[data-modal="'+t+'"]').classList.add("active"),s.classList.add("active")})})});