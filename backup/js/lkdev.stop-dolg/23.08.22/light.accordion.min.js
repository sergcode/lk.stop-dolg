"use strict";const mediaQueryTask=window.matchMedia("(max-width: 991.98px)"),mediaQueryTaskSmart=window.matchMedia("(max-width: 440.98px)");function createModalSendFileActiveTask(e,t){let o=document.querySelector(".toggle-modal-bg");const n=document.createElement("div");n.classList.add("toggle-modal"),n.setAttribute("role","dialog"),n.setAttribute("data-modal","filesSentSuccessfully"),n.innerHTML=`\n\t\t<div class="toggle-modal__box toggle-modal__box_p-none">\n      <div class="toggle-modal__body toggle-modal__body_white toggle-modal__body_pt-sm-50">\n        <p class="modal__text modal__text_bold">${e}</p>\n        <p class="modal__text modal__text_middle modal__text_light modal__text_grey">${t}</p>\n      </div>\n    </div>\n    <button class="toggle-modal__close toggle-modal__close_sm-green js-modal-close" title="Закрыть" role="button"></button>\n\t`,o.before(n)}const activeAndCloseModal={modalSendFileActiveTask:function(){return document.querySelector('.toggle-modal[data-modal="filesSentSuccessfully"]')},modalBtnClose:function(){return document.querySelector('.toggle-modal[data-modal="filesSentSuccessfully"] .toggle-modal__close').addEventListener("click",activeAndCloseModal.closeModalSendFileActiveTask)},toggleModalBg:()=>document.querySelector(".toggle-modal-bg"),activeModalSendFileActiveTask:function(){createModalSendFileActiveTask("Файлы успешно отправлены!","Задача передана юристу на проверку."),activeAndCloseModal.modalSendFileActiveTask().classList.add("active"),activeAndCloseModal.toggleModalBg().classList.add("active"),activeAndCloseModal.modalBtnClose()},activeModalErrorSendFileActiveTask:function(){createModalSendFileActiveTask("Ошибка при отправке файлов!","Задача не передана юристу на проверку."),activeAndCloseModal.modalSendFileActiveTask().classList.add("active","errorSend"),activeAndCloseModal.toggleModalBg().classList.add("active"),activeAndCloseModal.modalBtnClose()},closeModalSendFileActiveTask:function(){activeAndCloseModal.modalSendFileActiveTask().classList.add("remove"),activeAndCloseModal.toggleModalBg().classList.add("remove"),setTimeout(()=>{activeAndCloseModal.modalSendFileActiveTask().classList.remove("active"),activeAndCloseModal.modalSendFileActiveTask().classList.remove("remove"),activeAndCloseModal.toggleModalBg().classList.remove("active"),activeAndCloseModal.toggleModalBg().classList.remove("remove")},300),activeAndCloseModal.modalSendFileActiveTask().classList.contains("errorSend")&&activeAndCloseModal.modalSendFileActiveTask().classList.remove("errorSend")}};function formatFiles(e,t){switch(e){case"jpg":case"jpeg":case"png":case"tif":case"bmp":t.classList.add("task__accordion_item__purple");break;case"pdf":t.classList.add("task__accordion_item__red");break;case"doc":case"docx":case"odt":case"txt":t.classList.add("task__accordion_item__dark-blue");break;case"xls":case"xlsx":t.classList.add("task__accordion_item__green");break;case"ppt":case"pptx":t.classList.add("task__accordion_item__orange");break;case"rar":case"zip":case"7z":case"tar":case"arj":case"jar":t.classList.add("task__accordion_item__gold");break;default:t.classList.add("task__accordion_item__neutral")}}function attachFileCopyExtension(){document.querySelectorAll(".task__accordion_item--buttons-wrapper ul li a").forEach(e=>{const t=document.createElement("p"),o=document.createElement("span"),n=document.createElement("span");o.classList.add("task__accordion_item--name-file"),n.classList.add("task__accordion_item--download-file"),n.innerHTML='\n\t\t\t<svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M40.0181 27.1973L25 42.2153L9.98192 27.1973L12.7441 24.435L23.0469 34.7378V0H26.9531V34.7378L37.2559 24.435L40.0181 27.1973ZM50 46.0938H0V50H50V46.0938Z" fill="black"/>\n\t\t\t</svg>\n\t\t';let a=e.getAttribute("href"),l=decodeURI(a.split("/").pop());e.textContent||(e.prepend(t),e.append(o),e.append(n)),e.querySelectorAll(".task__accordion_item--name-file").forEach(t=>{t.textContent=l;let o=e.querySelectorAll("p"),n=t.textContent,a=n.split(".").pop();o.forEach(e=>{e.textContent=a,formatFiles(a,e.closest("li"))}),t.textContent=n.beforeLastIndex("."),e.setAttribute("title",`Скачать файл: ${l}`),e.setAttribute("download",`${l}`)})})}function filtersAccordionTask(){let e=document.querySelectorAll(".task__accordion-btn"),t=document.querySelectorAll(".task__filters > .button"),o=[];const n=document.getElementById("resetFilters");e.forEach(a=>{let l=a.nextElementSibling,i=a.getAttribute("name"),s=[];const c=e=>{e.setAttribute("disabled","disabled"),s=[],o=[],location.hash&&history.pushState("",document.title,window.location.pathname),a.removeAttribute("style"),l.style.display=null};t.forEach(t=>{t.getAttribute("id")===i&&(t.querySelector(".task__filters_num").textContent=`${a.nextElementSibling.querySelectorAll(".task__accordion-item-btn").length}`),t.addEventListener("click",function(r){r.preventDefault(),o.push(this.getAttribute("id")),this.classList.add("active"),this.setAttribute("disabled","disabled"),a.style.display="none",l.style.display="none",o.forEach(e=>{let t=document.querySelectorAll(`[name="${e}"]`);e===i&&t.forEach(e=>{let t=e.nextElementSibling;e.removeAttribute("style"),t.style.display=null})}),t.classList.contains("active")&&(n.removeAttribute("disabled"),s.push(t),s.length===e.length&&(s.forEach(e=>{e.classList.remove("active"),e.removeAttribute("disabled")}),c(n)),n.addEventListener("click",function(e){e.preventDefault(),t.classList.remove("active"),t.removeAttribute("disabled"),c(this)}))})})})}function createInfoProcessing(){const e=document.createElement("span");return e.classList.add("task__accordion_item--info-in-processing"),e.innerHTML='\n\t  <svg width="35" height="40" viewBox="0 0 35 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd" d="M12.2 4.4C11.8 4.4 11.6 4.6 11.6 5V11.8L4.7 14.7C4.4 14.8 4.3 15.2 4.4 15.5C4.5 15.8 4.7 15.9 5 15.9C5.1 15.9 5.2 15.9 5.3 15.8L12.6 12.7C12.9 12.6 13 12.4 13 12.1V5C12.8 4.6 12.6 4.4 12.2 4.4ZM12.2 24.4C5.4 24.4 0 18.9 0 12.2C0 5.4 5.6 0 12.2 0C18.6 0 24.1 5.1 24.4 11.7H31.7C33.1 11.7 34.2 12.8 34.2 14.2V16.1C34.2 16.5 33.9 16.7 33.6 16.7H32.8C32.1 17.9 29.5 22.3 27.2 24.9C26.8 25.4 26.8 26.2 27.2 26.7C29.4 29.3 32.1 33.8 32.8 35H33.7C34.1 35 34.3 35.3 34.3 35.6V38.1C34.3 39.2 33.5 40 32.4 40H16.4C15.3 40 14.5 39.2 14.5 38.1V35.6C14.5 35.2 14.8 35 15.1 35H16C16.7 33.8 19.3 29.4 21.6 26.7C22 26.2 22 25.4 21.6 24.9C20.8 24 20.1 23 19.3 22C17.3 23.6 14.8 24.4 12.2 24.4ZM33 38.1V36.2C28.9 36.2 19.8 36.2 15.8 36.2V38.1C15.8 38.5 16 38.7 16.4 38.7H32.4C32.8 38.8 33 38.5 33 38.1ZM26.2 24.1C28.1 21.9 30.3 18.3 31.3 16.7H17.4C18.4 18.4 20.6 22 22.5 24.1C23.4 25 23.4 26.5 22.5 27.5C20.6 29.7 18.4 33.2 17.4 34.9H31.3C30.3 33.2 28.1 29.6 26.2 27.5C25.3 26.6 25.3 25.1 26.2 24.1ZM33 14.2C33 13.5 32.4 12.9 31.8 12.9H17C16.3 12.9 15.7 13.5 15.7 14.2V15.5C20 15.5 28.6 15.5 32.9 15.5V14.2H33ZM17 11.7C15.6 11.7 14.5 12.8 14.5 14.2V16.1C14.5 16.5 14.8 16.7 15.1 16.7H15.9C16.3 17.4 17.3 19.1 18.6 21C16.9 22.2 14.8 23 12.7 23.1V22.5C12.7 22.1 12.4 21.9 12.1 21.9C11.7 21.9 11.5 22.1 11.5 22.5V23.1C8.9 23 6.6 21.9 4.9 20.3L5.3 19.9C5.6 19.6 5.6 19.3 5.3 19C5 18.7 4.7 18.7 4.4 19L4 19.4C2.4 17.6 1.4 15.3 1.2 12.8H1.8C2.2 12.8 2.4 12.5 2.4 12.2C2.4 11.9 2.1 11.6 1.8 11.6H1.3C1.4 9 2.5 6.7 4.1 4.9L4.5 5.3C4.8 5.6 5.1 5.6 5.4 5.3C5.7 5 5.7 4.7 5.4 4.4L4.9 4.1C6.8 2.4 9 1.4 11.6 1.3V1.9C11.6 2.3 11.9 2.5 12.2 2.5C12.5 2.5 12.8 2.2 12.8 1.9V1.3C15.4 1.4 17.7 2.5 19.4 4L19 4.5C18.7 4.8 18.7 5.1 19 5.4C19.3 5.7 19.6 5.7 19.9 5.4L20.3 5C21.9 6.8 22.9 9.2 23 11.7H17ZM22.2 31.3V32.6C22.2 33 22.5 33.2 22.8 33.2C23.1 33.2 23.4 32.9 23.4 32.6V31.3C23.4 30.9 23.1 30.7 22.8 30.7C22.5 30.7 22.2 30.9 22.2 31.3ZM25.9 33.1C26.3 33.1 26.5 32.8 26.5 32.5V31.2C26.5 30.8 26.2 30.6 25.9 30.6C25.5 30.6 25.3 30.9 25.3 31.2V32.5C25.3 32.8 25.6 33.1 25.9 33.1ZM24.4 21.8C24.8 21.8 25 21.5 25 21.2V19.9C25 19.5 24.7 19.3 24.4 19.3C24 19.3 23.8 19.6 23.8 19.9V21.2C23.8 21.5 24 21.8 24.4 21.8Z" fill="#275957"/>\n\t\t</svg>\n\t  <span>Информация в обработке</span>  \n\t',e}function deleteInfoProcessing(e){e.querySelectorAll(".task__accordion_item--info-in-processing").forEach(e=>{e.style.opacity="0",e.remove()})}function taskAccordionItemTitle(e){e.querySelector(".task__accordion_item--wrapper-text").append(createInfoProcessing()),createInfoProcessing().style.opacity="1"}function createInfoProcessingItemInfo(e){e.querySelector(".task__accordion_item--info").querySelector(".task__accordion_item--text-task").after(createInfoProcessing()),createInfoProcessing().style.opacity="1"}function lightAccordionNextElementSibling(){let e=document.querySelectorAll(".task__accordion-btn");e.forEach(e=>{let t=e.nextElementSibling.querySelectorAll(".task__accordion-item-btn");e.querySelectorAll("span").forEach(e=>{e.textContent=`${t.length}`}),e.addEventListener("click",function(e){if(e.preventDefault(),this.nextElementSibling.children.length>0){this.classList.toggle("is-open");let e=this.nextElementSibling,t=e.querySelectorAll(".task__accordion-item-btn"),o=e.querySelectorAll(".task__accordion_item--more-info");t.forEach(e=>{const t=e.querySelector(".task__accordion_item--wrapper-text").lastElementChild.classList.contains("task__accordion_item--info-in-processing");this.matches('[name="onCheckTask"]')&&mediaQueryTask.matches&&this.classList.contains("is-open")&&!t&&taskAccordionItemTitle(e)}),e.style.maxHeight?(e.style.maxHeight=null,t.forEach(e=>{e.classList.contains("is-open")&&e.classList.remove("is-open")}),o.forEach(e=>{e.style.maxHeight&&(e.style.maxHeight=null),mediaQueryTask.matches&&this.matches('[name="onCheckTask"]')&&!this.classList.contains("is-open")&&deleteInfoProcessing(e)})):e.style.maxHeight=e.scrollHeight+"px"}})})}function childAccordionTask(){document.querySelectorAll(".task__accordion_wrapper").forEach(e=>{e.onclick=function(t){let o=t.target.closest(".task__accordion-item-btn");o&&e.contains(o)&&function(e){const t=e.nextElementSibling,o=t.querySelector(".task__accordion_item--more-wrapper"),n=e.closest(".task__accordion_wrapper").previousElementSibling.matches('[name="onCheckTask"]');attachFileCopyExtension(),e.classList.toggle("is-open"),t.style.maxHeight?t.style.maxHeight=null:(t.style.maxHeight=t.scrollHeight+o.scrollHeight+"px",t.parentElement.style.maxHeight=t.parentElement.scrollHeight+t.scrollHeight+"px");t.previousElementSibling.classList.contains("is-unread")&&t.previousElementSibling.classList.remove("is-unread");if(mediaQueryTask.matches&&n){const o=e.classList.contains("is-open"),n=e.querySelector(".task__accordion_item--wrapper-text");o&&!t.querySelector(".task__accordion_item--info-in-processing")&&n.lastElementChild.classList.contains("task__accordion_item--info-in-processing")?(n.lastElementChild.style.opacity="0",n.lastElementChild.remove(),createInfoProcessingItemInfo(t)):o||n.lastElementChild.classList.contains("task__accordion_item--info-in-processing")||(deleteInfoProcessing(t),taskAccordionItemTitle(e))}}(o)}})}function sendFilesActiveTask(){let e=document.querySelectorAll(".task__accordion-btn"),t=document.querySelector(".toggle-modal-bg"),o=document.querySelector('.task__accordion-btn[name="onCheckTask"]'),n=o.nextElementSibling,a=document.querySelectorAll(".task__filters > .button");e.forEach(e=>{let l=e.querySelectorAll("span"),i=e.getAttribute("name"),s=e.nextElementSibling,c=s.querySelectorAll(".task__accordion-item-btn"),r=s.nextElementSibling;c.forEach(e=>{e.nextElementSibling.querySelectorAll("form.task__add-file").forEach(s=>{s.addEventListener("submit",function(c){c.preventDefault();let d=new XMLHttpRequest;d.open("POST","/assets/ajax.php");let m=this.querySelector('.attach__button[name="taskAccordionAttach"]'),_=e.nextElementSibling.querySelectorAll(".attach__item--attached .attach__name"),u=new FormData(s);u.append("action","sendFormFiles"),m.hasAttribute("disabled")||(d.addEventListener("load",()=>{if(200===d.status){console.log(d.response),l.forEach(e=>{e.textContent--}),a.forEach(e=>{e.getAttribute("id")===i&&e.querySelector(".task__filters_num").textContent--}),"onCheckTask"===r.getAttribute("name")&&(r.querySelector("span").textContent++,a.forEach(e=>{e.getAttribute("id")===r.getAttribute("name")&&e.querySelector(".task__filters_num").textContent++})),e.classList.remove("is-open"),e.classList.add("filesPosted"),e.nextElementSibling.hasAttribute("style")&&e.nextElementSibling.removeAttribute("style");let s=e.cloneNode(!0),c=e.nextElementSibling.cloneNode(!0);c.querySelector(".task__accordion_item--buttons").innerHTML='\n\t\t\t\t\t\t\t\t\t<div class="task__accordion_item--buttons-wrapper">\n\t\t\t              <ul>\n\t\t\t                <li>Прикреплённые файлы:</li>\n\t\t\t              </ul>\n\t\t\t            </div>\n\t\t\t\t\t\t\t\t';let m=c.querySelector(".task__accordion_item--buttons-wrapper ul");if(_.forEach(e=>{let t=e.textContent,o=e.parentElement.querySelector("p").textContent,n=document.createElement("li");n.innerHTML=`\n\t\t\t\t\t\t\t\t\t\t<a href="/assets/photo/${t}.${o}" title="Скачать файл" role="button" download></a>\n\t\t\t\t\t\t\t\t\t`,m.append(n)}),mediaQueryTask.matches&&taskAccordionItemTitle(s),setTimeout(()=>{e.remove()},400),setTimeout(()=>{e.nextElementSibling.remove()},399),setTimeout(()=>{activeAndCloseModal.activeModalSendFileActiveTask()},400),t.addEventListener("click",activeAndCloseModal.closeModalSendFileActiveTask),o){n.prepend(s);let e=n.querySelectorAll(".task__accordion-item-btn"),t=n.querySelectorAll(".task__accordion_item--more-info");e.forEach(e=>{let t=e.querySelectorAll(".task__accordion_item--right-elements");e.classList.contains("filesPosted")&&setTimeout(()=>e.classList.remove("filesPosted"),100),t.forEach(e=>{e.querySelector(".task__accordion_item--info-in-processing")||(e.prepend(createInfoProcessing()),createInfoProcessing().style.opacity="1")})}),o.classList.contains("is-open")&&t.forEach(e=>{e.parentElement.style.maxHeight=e.parentElement.scrollHeight+e.scrollHeight+"px"}),n.firstChild.after(c)}}else activeAndCloseModal.activeModalErrorSendFileActiveTask(),t.addEventListener("click",activeAndCloseModal.closeModalSendFileActiveTask)}),d.send(u))})})})})}function btnCloseChildAccordion(){document.querySelectorAll(".task__accordion_item--close-info").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.closest(".task__accordion-item-btn"),o=t.nextElementSibling,n=this.closest(".task__accordion_wrapper").previousElementSibling.matches('[name="onCheckTask"]');mediaQueryTask.matches&&n&&(t.classList.contains("is-open")?(deleteInfoProcessing(t),createInfoProcessingItemInfo(o)):(deleteInfoProcessing(o),taskAccordionItemTitle(t)))},!1)})}function handleOrientationChangeSmartphone(e){document.querySelectorAll(".task__accordion-btn").forEach(t=>{t.nextElementSibling.querySelectorAll(".task__accordion_item--more-info").forEach(t=>{let o=t.querySelector(".task__accordion_item--more-wrapper");const n=()=>{t.parentElement.style.maxHeight&&(t.parentElement.style.maxHeight=t.parentElement.scrollHeight+t.scrollHeight+"px"),t.style.maxHeight&&(t.style.maxHeight=t.scrollHeight+o.scrollHeight+"px")};e.matches,n()})})}function handleOrientationChange(e){document.querySelectorAll(".task__accordion-btn").forEach(t=>{t.nextElementSibling.querySelectorAll(".task__accordion-item-btn").forEach(o=>{let n=o.classList.contains("is-open");const a=o.querySelector(".task__accordion_item--wrapper-text"),l=a.lastElementChild.classList.contains("task__accordion_item--info-in-processing"),i=o.nextElementSibling;let s=i.querySelector(".task__accordion_item--info-in-processing");e.matches?(t.matches('[name="onCheckTask"]')&&(n&&!s?createInfoProcessingItemInfo(i):n||l||(deleteInfoProcessing(i),taskAccordionItemTitle(o))),i.parentElement.style.maxHeight&&(i.parentElement.style.maxHeight=i.parentElement.scrollHeight+i.scrollHeight+"px"),i.style.maxHeight&&(i.style.maxHeight=i.scrollHeight+i.querySelector(".task__accordion_item--more-wrapper").scrollHeight+"px")):t.matches('[name="onCheckTask"]')&&(l?(a.lastElementChild.style.opacity="0",a.lastElementChild.remove()):s&&deleteInfoProcessing(i))})})}attachFileCopyExtension(),filtersAccordionTask(),lightAccordionNextElementSibling(),childAccordionTask(),sendFilesActiveTask(),btnCloseChildAccordion(),handleOrientationChangeSmartphone(mediaQueryTaskSmart),mediaQueryTaskSmart.addEventListener("change",handleOrientationChangeSmartphone),handleOrientationChange(mediaQueryTask),mediaQueryTask.addEventListener("change",handleOrientationChange);